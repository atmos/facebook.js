h1. Facebook Connect for NodeJS

_Note: I wrote an "article on howtonode.org":http://howtonode.org/facebook-connect on how to use Facebook Connect with Node_

This library contains NodeJS and jQuery scripts together with examples that allow you to easily integrate with Facebook. By making use of "Facebook's Javascript Client Library":http://wiki.developers.facebook.com/index.php/JavaScript_Client_Library we only have to do the minimal amount effort on the server-side, which "could be a good thing":http://synaptify.com/?p=613702.

There are two main ways of integrating with Facebook and both require you to "sign up for a Facebook Application":http://facebook.com/developer. If you want your web application to run inside Facebook, you need to make sure to verify users inside the Facebook Canvas (See example 2), otherwise, if you want users to use Facebook Connect to log onto your site, check Example 1.

h2. Dependencies

In order to use these plugins, you need to install both "NodeJS":http://nodejs.org and the "Express Web Framework":http://github.com/visionmedia/express/ on top of it.

Express can easily be installed like this:

<pre><code>kiwi install express
cd myproject
git init
</code></pre>

Also, we need to install "hashlib":http://github.com/brainfucker/hashlib, a NodeJS library provided by mr Brainfucker:

h2. Setting up your Project

1. Create the necessary folders:

<pre><code>cd myproject
mkdir -p lib
mkdir -p public/javascripts
</code></pre>

h2. Example 1: FB Connect

See "examples/fb_connect":node-facebook/blob/master/examples/fb_connect for the these example files.

h3. /app.js

<pre><code>
require.paths.unshift(__dirname + '/../../lib')
require('hashlib')

var kiwi = require('kiwi')

kiwi.require('express')
     require('express/plugins')
kiwi.require('facebook')

configure(function(){
  use(Static)
  use(Cookie)
  use(Logger)
  use(Session, { lifetime: (15).minutes, reapInterval: (1).minute })
  use(ContentLength)
  use(MethodOverride)
  use(require('facebook').Facebook, {
    apiKey    : process.env['FB_API_KEY'],
    apiSecret : process.env['FB_SECRET_KEY']
  })
  set('root', __dirname)
})

// Static files in ./public
get('/', function(file){ this.sendfile(__dirname + '/public/index.html') })

run()

</code></pre>

h3. /public/index.html

<pre><code><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
 <head>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.facebook.js"></script>
    <script type="text/javascript" src="/javascripts/app.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        $.fbInit('e1249f7d4bc25b8f90e5c9c7523e3ee1');
      });
    </script>
    <script type="text/javascript" src="http://static.ak.connect.facebook.com/js/api_lib/v0.4/FeatureLoader.js.php"></script>
  </head>

  <body>
    <div id="fb-root"></div>
    <div id="my-account">
      <div class="authenticated" style="display: none">
        Hi there <span id="fb-first_name"></span>!
        <a href="#" id="fb-logout">Logout</a>
      </div>
      <div class="not_authenticated" style="display: none">
        <a href="#" id="fb-connect">Connect with Facebook</a>
      </div>
    </div>
  </body>
</html>
</code></pre>

h2. Example 2: A Facebook Application running in the Canvas

See "examples/fb_iframe":node-facebook/blob/master/examples/fb_iframe for the these example files.

h3. /app.js

<pre><code>
require.paths.unshift(__dirname + '/../../lib')
require('hashlib')

var kiwi = require('kiwi')

kiwi.require('express')
     require('express/plugins')
kiwi.require('facebook')

configure(function(){
  use(Static)
  use(Cookie)
  use(Logger)
  use(Session, { lifetime: (15).minutes, reapInterval: (1).minute })
  use(ContentLength)
  use(MethodOverride)
  use(require('facebook').Facebook, {
    apiKey    : process.env['FB_API_KEY'],
    apiSecret : process.env['FB_SECRET_KEY']
  })
  set('root', __dirname)
})

// Static files in ./public
// This is the canvas URL set in the Facebook Application settings
get('/iframe', function (){
  var fbSession = this.fbSession() // Will create a session based on verified data from the GET params
  this.sendfile(__dirname + '/public/iframe.html')
})

run()

</code></pre>

h3. /public/iframe.html

<pre><code>
<html>
 <head>
    <title>Nodogoshi</title>
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.3.2/jquery.min.js"></script>
    <script type="text/javascript" src="/javascripts/jquery.facebook.js"></script>
    <script type="text/javascript">
      $(document).ready(function () {
        $.fbInit('e1249f7d4bc25b8f90e5c9c7523e3ee1');

        // Check whether we're logged in and arrange page accordingly
        $.fbIsAuthenticated(function (fbSession) {
          // Authenticated!
          $.fbProfile(['first_name'], function (profile) {
            $('#fb-first_name').html(profile.first_name);
            $('.authenticated').show();
          });
        }, function () {
          // Not authenticated
          $('.not_authenticated').show();
          $('#authenticate').click(function () {
            $.fbIframeAuthenticate({'canvas_name': 'nodogoshi'});
            return false;
          });
        });
      });
    </script>
    <script type="text/javascript" src="http://static.ak.facebook.com/js/api_lib/v0.4/FeatureLoader.js.php"></script>
  </head>

  <body>
    <div id="fb-root"></div>
    <div id="my-account">
      <div class="authenticated" style="display: none">
        Hi there <span id="fb-first_name"></span>!
        <a href="#" id="fb-logout">Logout</a>
      </div>
      <div class="not_authenticated" style="display: none">
        Viewing anonymously, <a href="#" id="authenticate">click here</a> to authenticate.
      </div>
    </div>
  </body>
</html>
</code></pre>

h2. License

"MIT":http://www.opensource.org/licenses/mit-license.php
